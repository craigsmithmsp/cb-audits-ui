<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">



<dom-module id="questionabledetail-table">
    <template>
        <table>
            <tr>
                <th>Site Name</th>
                <th>Profile Name</th>
                <th>Profile Email</th>
                <th>Findings</th>
            </tr>

            <tr>
                <td>{{results.siteName}}</td>
                <td>{{results.profileName}}</td>
                <td>{{results.profileEmail}}</td>
                <td>
                    <ul>
                        <template is="dom-repeat" items="{{results.findings}}" as="finding">
                            <li>{{finding.details}}</li>
                        </template>
                    </ul>
                </td>
            </tr>
        </table>
        <h1>
            Hey this is id: {{results}}
        
        </h1>


        <iron-ajax id="passAjax" url="http://localhost:11000/ui/audits/summaries?status=QUESTIONABLE&type=SITE" method="GET" headers='{"Content-Type": "application/json"}' handle-as="json" on-response="onMarkPassedComplete" debounce-duration="300">
        </iron-ajax>

    </template>

    <script>
        Polymer({
            is: "questionabledetail-table",
            attached: function() {
                this.$.passAjax.generateRequest();

            },

            isFailed: function(item) {
                return item.status == 'FAILED';
            },

            markAsFailed: function() {
                var selectedItems = this.$.datatable.selectedItems;
                this.$.datatable.deselectAll();
            },

            onMarkPassedComplete: function(data) {
                var results = this.$.passAjax.lastResponse;
                this.results = results[0];
                console.log(results);
                //                results.forEach(function(result) {
                //                    if (!result.result) {
                //                        alert(result.msg);
                //                    }
                //                });
                //                //Refresh the datasource in table again
                //                this.$.datatableCard.retrieveVisibleData();
            },

            markAsPassed: function(event) {
                var ids = this.getSelectedIds(this);
                console.log(ids);
                request = {}
                request['auditIds'] = ids;
                request['status'] = 'PASSED';
                var reqBody = JSON.stringify(request);
                console.log('Sending upate request as: ' + reqBody);
                this.$.passAjax.body = reqBody;
                this.$.passAjax.generateRequest();
                this.refreshTable();
            },

            properties: {
                auditId: String
            }
        });

    </script>
</dom-module>
