<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">



<dom-module id="questionabledetail-table">
    <template>
        <style>
        	table {
        	table-layout: fixed;
        	}
        	
            table,th,td {
                border: 1px solid black;
                border-collapse: collapse;
            }
      
            td {
                height: 100px;
                width: 100px;
                text-align: center;
                vertical-align:center;
            }
            
            #findingsTd{
            width: 50em;
            }
            
            ul {
                padding-left: 30px;
            }
            
            li {
                list-style-type: square;
            }
            
            #findings {
                overflow-y: scroll;
                height:100%;
            }

        </style>


        <table>
            <tr>
                <th>Site Name</th>
                <th>Site ID</th>
                <th>Site Created At</th>
                <th>Profile Name</th>
                <th>Profile Email</th>
                <th>Profile Created At</th>
                <th>Sibling Site Count</th>
                <th>Findings</th>
                <th>Last Modified User</th>
                <th>Last Modified Date</th>


            </tr>

            <tr>
                <td>{{result.siteName}}</td>
                <td>{{result.siteId}}</td>
                <td>{{result.siteCreatedAt}}</td>
                <td>{{result.profileName}}</td>
                <td>{{result.profileEmail}}</td>
                <td>{{result.profileCreatedAt}}</td>
                <td>{{result.siblingSiteCount}}</td>
                <td id = "findingsTd">
                <div id="findings">
                <ul>
                        <template is="dom-repeat" items="{{result.findings}}" as="finding" filter="isFailed">
                            <li><b>Rule Name:</b> {{finding.ruleName}}</li>
                            <li><b>Last Run Date:</b> {{finding.lastRunDate}}</li>
                            <li><b>Failure Detail:</b> {{finding.details}}</li>
                        </template>
                    </ul>
                </div>
                    
                </td>
                <td>{{result.lastModifiedUser}}</td>
                <td>{{result.lastModified}}</td>
            </tr>
        </table>


        <iron-ajax id="passAjax" url="http://localhost:11000/ui/audits/details/{{auditId}}" debounce-duration="300" on-response="handleResult">
        </iron-ajax>

    </template>

    <script>
        Polymer({
            is: "questionabledetail-table",
            attached: function() {
                this.$.passAjax.generateRequest();

            },

            isFailed: function(item) {
                return item.status == 'FAILED';
            },

            markAsFailed: function() {
                var selectedItems = this.$.datatable.selectedItems;
                this.$.datatable.deselectAll();
            },

            handleResult: function(data) {
                var result = this.$.passAjax.lastResponse;
                this.result = result;
            },

            markAsPassed: function(event) {
                var ids = this.getSelectedIds(this);
                console.log(ids);
                request = {}
                request['auditIds'] = ids;
                request['status'] = 'PASSED';
                var reqBody = JSON.stringify(request);
                console.log('Sending upate request as: ' + reqBody);
                this.$.passAjax.body = reqBody;
                this.$.passAjax.generateRequest();
                this.refreshTable();
            },

            properties: {
                auditId: String
            }
        });

    </script>
</dom-module>
